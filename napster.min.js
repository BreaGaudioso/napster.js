!function(a,b,c){"use strict";function d(){return"FLASH_PLAYER"===f}if(a&&b&&b.ajax&&c){var e=c.stringify;c.stringify=function(a){return e(a,function(a,b){return"genre"===a?{id:b.id,name:b.name}:b})};var f,g,h=function(a,b,c){var d=a[b];a[b]=function(){return c.length===arguments.length?c.apply(this,arguments):"function"==typeof d?d.apply(this,arguments):void 0}},i="napster.member.accessToken",j="napster.member.refreshToken",k=function(a){for(var b in a)this[b]=a[b]},l={init:function(a){function c(){if(!0===a.isHTML5Compatible)return!0}this.api.consumerKey=a.consumerKey,g=a.consumerKey,this.api.version=a.version||this.api.version,this.api.catalog=a.catalog||this.api.catalog;var d=a.player||"player-frame";if(d&&"string"==typeof d){var e=this,h=b("#"+d);if(c())f="HTML5_PLAYER",b("<video id='napster-streaming-player' class='video-js'></video>").appendTo(b(document.body)),b.ajax({url:"http://origin-napi-gateway-int.internal.rhapsody.com/v2/streaming-player.js",dataType:"script",async:!0,success:function(){l.player.fire("ready")}});else if(f="FLASH_PLAYER",0===h.length)b(function(){var c=b("<iframe></iframe>").attr("id",d).attr("name",d).attr("src","http://api.napster.com/v1.1/player/index.html?apikey="+a.consumerKey).attr("frameborder","no").attr("style","display:none;").appendTo(b(document.body)).load(function(){e.player.win=c.get(0)})});else{if(!(h.get(0)instanceof HTMLIFrameElement))throw new Error('The element "'+d+'" is not an HTMLIFrameElement.');e.player.win=h.get(0)}}},api:{host:"api.napster.com",catalog:"US",version:"v2.2",endpoint:function(a){return(a?"https://":"http://")+[this.host,this.version].join("/")},headers:function(a){var b={};return a&&l.member.accessToken&&(b.Authorization="Bearer "+l.member.accessToken),b},dataType:function(){return"json"},get:function(a,c,d){var e={apikey:this.consumerKey};b.ajax({type:"GET",dataType:this.dataType(),data:e,headers:this.headers(a),url:this.endpoint(a)+c,success:function(a,b,c){d(a)},error:function(a){d({status:a.status,error:a.statusText,response:a.responseJSON})}})},post:function(a,c,d,e){d||(d={}),b.ajax({type:d._method||"POST",data:d,dataType:this.dataType(),headers:this.headers(a),url:this.endpoint(a)+c+(a?"":"?apikey="+this.consumerKey),success:function(a,b,c){e(a)},error:function(a){e({status:a.status,error:a.statusText,response:a.responseJSON})}})},put:function(a,b,c,d){c._method="PUT",this.post.call(this,a,b,c,d)},del:function(a,b,c,d){c._method="DELETE",this.post.call(this,a,b,c,d)}},member:new function(){return new k({accessToken:a.localStorage[i],refreshToken:a.localStorage[j]})},player:{frameReady:!1,ready:!1,streamingPlayer:void 0,queued:[],played:[],repeat:!1,shuffled:!1,auth:function(){if(d())l.api.consumerKey&&l.member.accessToken&&l.windows(this.win).post("auth",{consumerKey:l.api.consumerKey,accessToken:l.member.accessToken});else{this.streamingPlayer=new StreamingPlayer({id:"napster-streaming-player",apikey:g,token:l.member.accessToken,enableLogging:!0,bitrate:192,downgrade:!0,currentUser:{},env:"production"});var a=this;this.streamingPlayer.callbackHandler("trackEnded",function(){!1===a.repeat?a.next():a.streamingPlayer.play(a.currentTrack,"UNKNOWN")})}},play:function(a){if(d())return l.previewer.pause(),l.windows(this.win).post("play",a),this;this.streamingPlayer.play(a,"UNKNOWN"),this.played.push(a),window.parent.postMessage({type:"playevent",data:{id:a,code:"PlayStarted",playing:!0}},"*")},pause:function(){if(d())return l.windows(this.win).post("pause"),this;this.streamingPlayer.pause(),window.parent.postMessage({type:"playevent",data:{id:this.currentTrack,code:"Paused",playing:!1}},"*")},resume:function(){d()||(this.streamingPlayer.resume(this.currentTrack,"UNKNOWN"),window.parent.postMessage({type:"playevent",data:{id:this.currentTrack,code:"PlayStarted",playing:!0}},"*"))},next:function(){if(d())l.windows(this.win).post("playNext");else{(!1===this.shuffled?this.queued:this.shuffledQueued).length>=1&&(!1===this.shuffled?this.play(this.queued.pop()):this.play(this.shuffledQueued.pop()))}},previous:function(){d()?l.windows(this.win).post("playPrevious"):1===this.played.length?(this.streamingPlayer.play(this.played[0],"UNKNOWN"),window.parent.postMessage({type:"playevent",data:{id:this.played[0],code:"PlayStarted",playing:!0}},"*")):(!1===this.shuffled?this.queued.push(this.played.pop()):this.shuffledQueued.push(this.played.pop()),this.play(this.played.pop()))},queue:function(a){if(d())return l.windows(this.win).post("queue",a),this;this.queued.push(a)},clearQueue:function(){d()?l.windows(this.win).post("clearQueue"):(this.queued=[],this.shuffledQueued=[],this.played=[])},toggleShuffle:function(){d()?l.windows(this.win).post("toggleShuffle"):(this.shuffled=!0!==this.shuffled,this.shuffledQueued=this.queued.map(function(a){return[Math.random(),a]}).sort(function(a,b){return a[0]-b[0]}).map(function(a){return a[1]}))},toggleRepeat:function(){d()?l.windows(this.win).post("toggleRepeat"):this.repeat=!1===this.repeat},showQueue:function(){if(!d())return!0===this.shuffled?this.shuffledQueued:this.queued},showPlayed:function(){if(!d())return this.played},seek:function(a){d()?l.windows(this.win).post("seek",a):this.streamingPlayer.seek(this.currentTrack,a)},setVolume:function(a){d()?l.windows(this.win).post("setVolume",a):this.streamingPlayer.setVolume(a)},on:function(a,b){var c=this;return window.addEventListener("message",function(d){if("playerframeready"===d.data.type?c.frameReady=!0:"ready"===d.data.type?c.ready=!0:"playsessionexpired"===d.data.type&&(c.paused=!1,c.playing=!1),c.frameReady&&c.ready&&!c.authed&&(c.authed=!0,c.auth()),d.data.type===a){if(d.data.data&&d.data.data.id){d.data.data.id=d.data.data.id.replace("tra","Tra");var e=d.data.data.code,f="PlayStarted"===e||"PlayComplete"!==e&&"Paused"!==e&&"BufferEmpty"!==e&&"NetworkDropped"!==e&&"PlayInterrupted"!==e&&"IdleTimeout"!==e,g="Paused"===e||"NetworkDropped"===e||"PlayInterrupted"===e||"IdleTimeout"===e;c.playing=d.data.data.playing=f,c.paused=d.data.data.paused=g,c.currentTrack=c.playing||c.paused?d.data.data.id:null}b.call(this,d.data)}}),this},fire:function(a){window.parent.postMessage({type:a},"*")}},previewer:{play:function(){return this},pause:function(){return this}},windows:function(a){return{post:function(b,c){if(!a)throw new Error("An iframe was not found at that reference.");a.contentWindow.postMessage({method:b,args:l.util.jsonClean(c||{})},"*")}}},on:function(a,b){window.addEventListener(a,b)},util:{secondsToTime:function(a){if(!isNaN(a)){var b=Math.floor(a/60),c=Math.floor(a)%60;return b+":"+(c<10?"0"+c:c)}return"0:00"},jsonClean:function(a){return c.parse(c.stringify(a,function(a,b){return"genre"===a?{id:b.id,name:b.name}:b}))}}};h(k.prototype,"set",function(b){b&&b.accessToken&&b.refreshToken&&(this.accessToken=a.localStorage[i]=b.accessToken,this.refreshToken=a.localStorage[j]=b.refreshToken,l.player.auth(b.accessToken))}),h(k.prototype,"unset",function(){this.accessToken=this.refreshToken=null,a.localStorage.removeItem(i),a.localStorage.removeItem(j)}),h(k.prototype,"load",function(){return this.accessToken=a.localStorage[i],this.refreshToken=a.localStorage[j],this}),h(k.prototype,"signedIn",function(){return null!=this.accessToken&&null!=this.refreshToken}),l.player.on("playevent",function(a){}).on("playtimer",function(a){}),a.Napster=l,a.Member=k}}(window,jQuery,JSON);